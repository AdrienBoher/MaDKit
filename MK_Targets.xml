<?xml version="1.0" encoding="utf-8"?>
<!-- 
  Copyright 1998-2011 Fabien Michel, Olivier Gutknecht, Jacques Ferber
  
  This file is part of MadKit.
  
  MadKit is free software: you can redistribute it and/or modify
  it under the terms of the GNU Lesser General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
  
  MadKit is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Lesser General Public License for more details.
  
  You should have received a copy of the GNU Lesser General Public License
  along with MadKit. If not, see <http://www.gnu.org/licenses/>.
 -->
<!-- 
 This is ant MK_Targets.xml file. It contains targets for building MadKit projects:
 	executable jar
 	jnlp file
 	
 Author: Fabien Michel
 Version: 5.0
-->
<antlib>
	<macrodef name="create-executable-jar">
	<sequential>
	<echo>Building ${ant.project.name} executable jar</echo>	

	<property name="build.dir" value="build"/>
	<property name="executable.name" value="${ant.project.name}"/>
    <property name="kernel.jar.name" value="madkitkernel-${madkit.version}.jar"/>
    <property name="kernel.location" value="${madkit.lib.dir}/${kernel.jar.name}"/>
    <property name="kernel.properties.location" value="madkit/kernel/madkitKernel.properties"/>

 	<!-- ================================= 
          target: create-executable-jar              
         ================================= -->
    	<mkdir dir="${build.dir}"/>
    	<unzip src="${kernel.location}" dest="${build.dir}">
    	  <patternset>
    	    <include name="madkitAntTargets.xml"/>
    	  </patternset>
    	</unzip>
		  <path id="mk.classpath">
		    <fileset dir="${madkit.lib.dir}" includes="${kernel.jar.name}"/>
		  </path>
		<whichresource property="madkit.properties"
		                 resource="${kernel.properties.location}"
		                 classpathref="mk.classpath"/>
		                 
		<property url="${madkit.properties}"/>
    	
    	<ant antfile="${build.dir}/madkitAntTargets.xml" target="create-executable-jar" inheritrefs="true" inheritall="true" />

	</sequential>
</macrodef>

<macrodef name="create-lib-jar">
	<sequential>
	<echo>Building ${ant.project.name} lib jar</echo>	
	<property name="build.dir" value="build"/>
    <property name="kernel.jar.name" value="madkitkernel-${madkit.version}.jar"/>
    <property name="kernel.location" value="${madkit.lib.dir}/${kernel.jar.name}"/>
	<property name="executable.name" value="${ant.project.name}"/>
    <property name="kernel.properties.location" value="madkit/kernel/madkitKernel.properties"/>

 	<!-- ================================= 
          target: create-lib-jar              
         ================================= -->
    	<mkdir dir="${build.dir}"/>
    	<unzip src="${kernel.location}" dest="${build.dir}">
    	  <patternset>
    	    <include name="madkitAntTargets.xml"/>
    	  </patternset>
    	</unzip>
		  <path id="mk.classpath">
		    <fileset dir="${madkit.lib.dir}" includes="${kernel.jar.name}"/>
		  </path>
		<whichresource property="madkit.properties"
		                 resource="${kernel.properties.location}"
		                 classpathref="mk.classpath"/>
		                 
		<property url="${madkit.properties}"/>
    	
    	<ant antfile="${build.dir}/madkitAntTargets.xml" target="create-lib-jar" inheritrefs="true" inheritall="true" />

	</sequential>
</macrodef>

	<!-- ================================= 
          target: clean          
          TODO externalize properties in a property file in the mk.jar
         ================================= -->
 <macrodef name="clean">
 	<sequential>
	   	<echo>Cleaning ${ant.project.name}</echo>
		<property name="build.dir" value="build"/>
        <delete dir="${build.dir}"/>
        <delete file="README"/>
        <delete file="${ant.project.name}.jnlp"/>
        <delete file="${ant.project.name}-${version}.jar"/>
        <delete file="${ant.project.name}.jnlp.jar.pack.gz"/>
        <delete file="${ant.project.name}-lib-${version}.jar"/>
	</sequential>
</macrodef>

	<!-- ================================= 
          target: zip-project              
         ================================= -->
<macrodef name="zip-project">
 	<sequential>
 		<clean/>
		<zip destfile="${ant.project.name}-${version}.zip">
			<zipfileset dir="." prefix="${ant.project.name}-${version}"/>
		</zip>
	</sequential>
</macrodef>
</antlib>